---
title: "ARMStrong: отчет по выбросам"
date: 2022-11-20T10:00:20-08:00
draft: false
tags: ["armstrong", "report"]
categories: ["projects", "armstrong"]

---

# ARMStrong: как мы собираем отчеты по выбросам
{{< lead >}}
Контроль, контроль и еще раз контроль! Смотрим, какое количество активных газов мы выбрасываем, оцениваем их вес и формируем отчеты.
{{< /lead >}}

{{< alert >}}
**Внимание!** спасибо за внимание.
{{< /alert >}}

## Введение

На атомных, хим и металлургических предприятиях всегда требуется контроль за уровнем выхода активных веществ, которое сбрасывает предприятие. Эти уровни устанавливаются нормативными актами и не должны быть превышены.

На различных предприятиях отчетность ведётся по-разному, мы же разберем случай, когда есть оперативный контроллирующий персонал, который должен заносить запись об контроллируемой обстановке в оперативный журнал каждые _n_ часов, в начале смены или же посуточно.

Для этих целей был разработан небольшой модуль для клиента [ARMStrong](https://github.com/digital-armstrong/Armstrong.Client), который и будет формировать отчетность по выбрасываемым газам, средней активности на МЭД-точках контроля и \\(I_{131}\\)-участке.

## Формулы для расчетов

{{< katex >}}

{{< alert "twitter" >}}
**Для справки:** каждая точка представляет собой объект из истории измерений, который имеет три свойства:
```csharp
public class History
{
    public int Id { get; }
    public double SystemEventValue { get; }
    public DateTime EventDateTime { get; }
}
```
{{< /alert >}}

Суммарный выброс складывается из суммы средних значений измерений за период между соседними точками, умноженный на длительность выброса.

За период выброса мы принимаем дельту между соседними точками: \\(N_1\\) -- точка, которую принимаем за начало отсчета; \\(N_2\\) -- точка, принимаемая за окончание отсчета. 

Среднее по этим точкам мы берем по причине, что не представляется возможным предугадать, в какой момент времени между двумя соседними точками начался рост или спад.




Из суммы этих периодов и складывается суммарный выброс, который пока еще не учитывает установленный расход по трубе, поэтому полученную сумму нужно умножить на расход.

Расход хранится в формате \\(\dfrac{м^3}{час}\\), поэтому требуется привести его к \\(\dfrac{м^3}{сек}\\), для этого просто разделим его на 3600.

Учитывая вышесказанное мы можем вывести формулу расчета выбросов и применить её в коде клиента:

\\(S_{sum} = (\sum{\dfrac{N_1 + N_2}{2} \Delta T}) C_{sec} \\), где:

* \\(S_{sum}\\) -- суммарный выброс по точке контроля, \\(Бк\\);
* \\(\dfrac{N_1 + N_2}{2}\\) -- среднее значение по двум точкам, \\(\dfrac{Бк}{м^3}\\)
* \\(\Delta T\\) -- длительность выброса \\(T_2 - T_1\\), \\(сек.\\);
* \\(C_{sec}\\) -- расход газа через трубу канала \\(\dfrac{C_{hour}}{3600}\\), \\(\dfrac{м^3}{сек}\\).

Метод для расчета выбросов будет следующим:

```csharp
public double GetSystemBlowout(List<History> histories, Channel channel)
{
    double summaryBlowout, rawBlowoutSumm = 0;

    for (int i = 0; i < histories.Count - 1; i++)
    {
        DateTime firstPointDateTime = histories[i].EventDate;
        DateTime secondPointDateTime = histories[i + 1].EventDate;
        double deltaT = secondPointDateTime
                            .Substract(firstPointDateTime)
                            .TotalSeconds;

        double firstPointValue = histories[i].SystemEventValue;
        double secondPointValue = histories[i + 1].SystemEventValue;
        dobule averageValue = (firstPointValue + secondPointValue) / 2;

        rawBlowoutSumm += averageValue * deltaT;
    }

    double consumprion = channel.ChannelConsumption / 3600;
    summaryBlowout = rawBlowoutSumm * consumption;

    return summaryBlowout;
}
```
