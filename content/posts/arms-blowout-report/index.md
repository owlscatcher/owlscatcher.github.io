---
title: "ARMStrong: отчет по выбросам"
date: 2022-11-06T10:00:20-08:00
draft: false
tags: ["armstrong", "report"]
categories: ["projects", "armstrong"]
---

{{< katex >}}

# ARMStrong: как мы собираем отчеты по выбросам

{{< lead >}}
Контроль, контроль и еще раз контроль! Смотрим, какое количество активных газов мы выбрасываем, оцениваем их вес и формируем отчеты.
{{< /lead >}}

{{< alert >}}
**Внимание!** Спасибо за внимание.
{{< /alert >}}

## Введение

На атомных, хим и металлургических предприятиях всегда требуется контроль за уровнем выхода активных веществ, которое сбрасывает предприятие. Эти уровни устанавливаются нормативными актами и не должны быть превышены.

На различных предприятиях отчетность ведётся по-разному, мы же разберем случай, когда есть оперативный контроллирующий персонал, который должен заносить запись об контроллируемой обстановке в оперативный журнал каждые _n_ часов, в начале смены или же посуточно.

Для этих целей был разработан небольшой модуль для клиента [ARMStrong](https://github.com/digital-armstrong/Armstrong.Client), который и будет формировать отчетность по выбрасываемым газам, средней активности на МЭД-точках контроля и \\(I\_{131}\\)-участке.

## Рассчитываем выбросы

{{< alert "twitter" >}}
**Для справки:** каждая точка представляет собой объект из истории измерений, который имеет три свойства:

```csharp
public class History
{
    public int Id { get; }
    public double SystemEventValue { get; }
    public DateTime EventDateTime { get; }
}
```

{{< /alert >}}

Что бы вычислить, сколько _Бк_ было выброшено, нам нужно знать значение на момент начала расчёта, продолжительность выброса и значение на момент окончания расчёта. Значение на момент начала и окончания расчёта мы принимаем за \\(N_1\\) и \\(N_2\\) соответственно.

За продолжительность выброса мы возьмем \\(\Delta T\\), которая является просто разницей по времени между второй и первой точкой.

Таким образом для вычисления выброса нам требуется две точки и выброс будет расчитываться как:

\\(S = \dfrac{N_1 + N_2}{2} \Delta T\\)

Среднее по этим точкам мы берем по причине, что не представляется возможным предугадать, в какой момент времени между двумя соседними точками начался рост или спад. Минимальное время регистрации можно устанавливать в 2.5 секунды, но ввиду особенности блоков детектирования типа БДГБ-02П и подобных сокращать окно практически бессмысленно, это не приводит к увеличению точность.

Далее, чтобы вычислить суммарный расход, нужно просто просуммировать все результаты и умножить на расход по вентсистеме точки контроля.

Расход хранится в формате \\(\dfrac{м^3}{час}\\), поэтому требуется привести его к \\(\dfrac{м^3}{сек}\\), для этого просто разделим его на 3600.

Учитывая вышесказанное мы можем вывести формулу расчета выбросов и применить её в коде клиента:

\\(S_{sum} = (\sum{\dfrac{N_1 + N_2}{2} \Delta T}) C*{sec} \\), где:

- \\(S_{sum}\\) -- суммарный выброс по точке контроля, \\(Бк\\);
- \\(\dfrac{N_1 + N_2}{2}\\) -- среднее значение по двум точкам, \\(\dfrac{Бк}{м^3}\\)
- \\(\Delta T\\) -- длительность выброса \\(T_2 - T_1\\), \\(сек.\\);
- \\(C_{sec}\\) -- расход газа через вентсистему точки контроля \\(\dfrac{C_{hour}}{3600}\\), \\(\dfrac{м^3}{сек}\\).

Метод для расчета выбросов будет следующим:

```csharp
public double GetSystemBlowout(List<History> histories, Channel channel)
{
    double summaryBlowout, rawBlowoutSumm = 0;

    for (int i = 0; i < histories.Count - 1; i++)
    {
        DateTime firstPointDateTime = histories[i].EventDate;
        DateTime secondPointDateTime = histories[i + 1].EventDate;
        double deltaT = secondPointDateTime
                            .Substract(firstPointDateTime)
                            .TotalSeconds;

        double firstPointValue = histories[i].SystemEventValue;
        double secondPointValue = histories[i + 1].SystemEventValue;
        dobule averageValue = (firstPointValue + secondPointValue) / 2;

        rawBlowoutSumm += averageValue * deltaT;
    }

    double consumprion = channel.ChannelConsumption / 3600;
    summaryBlowout = rawBlowoutSumm * consumption;

    return summaryBlowout;
}
```

## Группируем выбросы по категориям

```csharp
// TODO завтра
```

## Рассчитываем среднее по МЭД и йодному участку

```csharp
// TODO
```

## Отображаем пользователю отчёт

Мы рассчитали выбросы, посчитали МЭД и йод, теперь настало время показать пользователю то, что мы насчитали.

Отображать отчёты будем в виде таблиц с _эспандером_, которым будут закрыты все лишние таблицы, что бы не отвлекали.

Пользователю будет предложен выбор интервала, за который он хочет получить отчет:

![Селектор даты](range_selector.png)

Далее будет собран и отображен сам отчёт:

![Отчёт](result_report.png)

## В планах

- Добавить файл настроек, в котором можно будет перечислять группы и параметры, по которым будет происходить сборка отчетов;
- Добавить возможность вывода отчёта в файл и/или отправка отчёта по почте.
